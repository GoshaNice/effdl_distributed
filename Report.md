# Report week6

Сразу прошу прощения, что не `pdf`

## SyncBatchNorm implementation && Tests for SyncBatchNorm

Пришлось найти формулы градиента, но результат стоил того. Параллельно с имплементацией SyncBatchNorm я сразу запускал и тесты. Это часть, которую еще можно сделать на маке, так что я потратил много времени и мало средств. Дальше остается сделать замеры

## Benchmarking the training pipeline

Чтобы замерить качество, скорость и потребление памяти:
Для торчовского `nn.SyncBatchNorm`:
```python
python torch_ddp_cifar100.py
```
Финальное качество:
```bash
Rank 0, loss: tensor([1.7873], device='cuda:0'), acc: tensor([0.1875], device='cuda:0')
Rank 1, loss: tensor([1.7852], device='cuda:1'), acc: tensor([0.1900], device='cuda:1')
```
Total time: 6612.446699184

Cuda Memory Summary:
```bash
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  30113 KiB |  66090 KiB | 322426 MiB | 322397 MiB |
|       from large pool |  29299 KiB |  65019 KiB | 308267 MiB | 308238 MiB |
|       from small pool |    814 KiB |   3063 KiB |  14159 MiB |  14158 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  30113 KiB |  66090 KiB | 322426 MiB | 322397 MiB |
|       from large pool |  29299 KiB |  65019 KiB | 308267 MiB | 308238 MiB |
|       from small pool |    814 KiB |   3063 KiB |  14159 MiB |  14158 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  30043 KiB |  64481 KiB | 319060 MiB | 319030 MiB |
|       from large pool |  29234 KiB |  63414 KiB | 304952 MiB | 304923 MiB |
|       from small pool |    808 KiB |   3057 KiB |  14108 MiB |  14107 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  96256 KiB |  96256 KiB |  96256 KiB |      0 B   |
|       from large pool |  90112 KiB |  90112 KiB |  90112 KiB |      0 B   |
|       from small pool |   6144 KiB |   6144 KiB |   6144 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  14943 KiB |  37233 KiB | 319449 MiB | 319434 MiB |
|       from large pool |  11661 KiB |  36165 KiB | 305280 MiB | 305269 MiB |
|       from small pool |   3282 KiB |   3762 KiB |  14168 MiB |  14165 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      37    |      47    |  309382    |  309345    |
|       from large pool |       6    |      11    |   58617    |   58611    |
|       from small pool |      31    |      39    |  250765    |  250734    |
|---------------------------------------------------------------------------|
| Active allocs         |      37    |      47    |  309382    |  309345    |
|       from large pool |       6    |      11    |   58617    |   58611    |
|       from small pool |      31    |      39    |  250765    |  250734    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       8    |       8    |       8    |       0    |
|       from large pool |       5    |       5    |       5    |       0    |
|       from small pool |       3    |       3    |       3    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      11    |      16    |  153350    |  153339    |
|       from large pool |       2    |       6    |   27396    |   27394    |
|       from small pool |       9    |      13    |  125954    |  125945    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```

Для кастомного `SyncBatchNorm`:
```python
python ddp_cifar100.py
```

Финальное качество:
```bash
Rank 1, loss: tensor([1.7855], device='cuda:1'), acc: tensor([0.1889], device='cuda:1')
Rank 0, loss: tensor([1.7876], device='cuda:0'), acc: tensor([0.1881], device='cuda:0')
```

Total time: 6801.850327476
```bash
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  27426 KiB |  62088 KiB | 326637 MiB | 326610 MiB |
|       from large pool |  26652 KiB |  61056 KiB | 311402 MiB | 311376 MiB |
|       from small pool |    774 KiB |   3024 KiB |  15234 MiB |  15234 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  27426 KiB |  62090 KiB | 326637 MiB | 326610 MiB |
|       from large pool |  26652 KiB |  61056 KiB | 311402 MiB | 311376 MiB |
|       from small pool |    774 KiB |   3024 KiB |  15234 MiB |  15234 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  26817 KiB |  61256 KiB | 320153 MiB | 320127 MiB |
|       from large pool |  26048 KiB |  60228 KiB | 304942 MiB | 304917 MiB |
|       from small pool |    769 KiB |   3018 KiB |  15211 MiB |  15210 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  96256 KiB |  96256 KiB |  96256 KiB |      0 B   |
|       from large pool |  90112 KiB |  90112 KiB |  90112 KiB |      0 B   |
|       from small pool |   6144 KiB |   6144 KiB |   6144 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  38109 KiB |  52691 KiB | 271693 MiB | 271656 MiB |
|       from large pool |  34788 KiB |  49664 KiB | 256447 MiB | 256413 MiB |
|       from small pool |   3321 KiB |   3801 KiB |  15246 MiB |  15243 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      36    |      48    |  336742    |  336706    |
|       from large pool |       5    |      10    |   58614    |   58609    |
|       from small pool |      31    |      41    |  278128    |  278097    |
|---------------------------------------------------------------------------|
| Active allocs         |      36    |      48    |  336742    |  336706    |
|       from large pool |       5    |      10    |   58614    |   58609    |
|       from small pool |      31    |      41    |  278128    |  278097    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       8    |       8    |       8    |       0    |
|       from large pool |       5    |       5    |       5    |       0    |
|       from small pool |       3    |       3    |       3    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      15    |      17    |  180060    |  180045    |
|       from large pool |       4    |       7    |   27343    |   27339    |
|       from small pool |      11    |      14    |  152717    |  152706    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

```


## Performance benchmarks

Чтобы запустить замеры нужно запустить:

```python
python benchmark_torch_syncbn.py
```

Предварительно в коде нужно выбрать своего бойца - кастомный или оригинальный SyncBatchNorm

Результаты для кастомного:

### Custom Results

```bash
---------------------
Hidden dim: 128, Batch size: 32
[Rank 0]
Time:
Mean 	 0.1390621140998519
Median 	 0.00154946149996249
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  50688 B   | 104960 B   |   2246 KiB |   2196 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50688 B   | 104960 B   |   2246 KiB |   2196 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  53248 B   | 104960 B   |   2246 KiB |   2194 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  53248 B   | 104960 B   |   2246 KiB |   2194 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  52232 B   | 103436 B   |   2216 KiB |   2165 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  52232 B   | 103436 B   |   2216 KiB |   2165 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1996 KiB |   2032 KiB |   4226 KiB |   2230 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1996 KiB |   2032 KiB |   4226 KiB |   2230 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13840712750006787
Median 	 0.0015549710001323547
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  50688 B   | 104960 B   |   2246 KiB |   2197 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50688 B   | 104960 B   |   2246 KiB |   2197 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  51200 B   | 104960 B   |   2246 KiB |   2196 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  51200 B   | 104960 B   |   2246 KiB |   2196 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  50181 B   | 103436 B   |   2216 KiB |   2167 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50181 B   | 103436 B   |   2216 KiB |   2167 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1998 KiB |   2032 KiB |   4228 KiB |   2230 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1998 KiB |   2032 KiB |   4228 KiB |   2230 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 128, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1390653965999263
Median 	 0.0012058480001542193
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  99840 B   | 203264 B   |   4326 KiB |   4228 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99840 B   | 203264 B   |   4326 KiB |   4228 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 102400 B   | 203264 B   |   4326 KiB |   4226 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 102400 B   | 203264 B   |   4326 KiB |   4226 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 101384 B   | 201740 B   |   4296 KiB |   4197 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101384 B   | 201740 B   |   4296 KiB |   4197 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1948 KiB |   2016 KiB |   6242 KiB |   4294 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1948 KiB |   2016 KiB |   6242 KiB |   4294 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1377064262001113
Median 	 0.0012254574999133183
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  99840 B   | 203264 B   |   4326 KiB |   4229 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99840 B   | 203264 B   |   4326 KiB |   4229 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 100352 B   | 203264 B   |   4326 KiB |   4228 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100352 B   | 203264 B   |   4326 KiB |   4228 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  99333 B   | 201740 B   |   4296 KiB |   4199 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99333 B   | 201740 B   |   4296 KiB |   4199 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1950 KiB |   2016 KiB |   6244 KiB |   4294 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1950 KiB |   2016 KiB |   6244 KiB |   4294 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 32
[Rank 0]
Time:
Mean 	 0.13332746870000847
Median 	 0.0012237730002198077
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100864 B   | 208384 B   |   4462 KiB |   4363 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100864 B   | 208384 B   |   4462 KiB |   4363 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 105472 B   | 208384 B   |   4462 KiB |   4359 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 105472 B   | 208384 B   |   4462 KiB |   4359 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 104456 B   | 206860 B   |   4432 KiB |   4330 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 104456 B   | 206860 B   |   4432 KiB |   4330 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1945 KiB |   2016 KiB |   6375 KiB |   4430 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1945 KiB |   2016 KiB |   6375 KiB |   4430 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       8    |     201    |     195    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       8    |     201    |     195    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1331688328998098
Median 	 0.0012086579999959213
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100864 B   | 208384 B   |   4462 KiB |   4364 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100864 B   | 208384 B   |   4462 KiB |   4364 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 101376 B   | 208384 B   |   4462 KiB |   4363 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101376 B   | 208384 B   |   4462 KiB |   4363 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 100357 B   | 206860 B   |   4432 KiB |   4334 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100357 B   | 206860 B   |   4432 KiB |   4334 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1949 KiB |   2016 KiB |   6379 KiB |   4430 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1949 KiB |   2016 KiB |   6379 KiB |   4430 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       8    |     201    |     196    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       8    |     201    |     196    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1378585768998164
Median 	 0.0017587544998605154
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199168 B   | 404992 B   |   8622 KiB |   8427 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199168 B   | 404992 B   |   8622 KiB |   8427 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 203776 B   | 404992 B   |   8622 KiB |   8423 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 203776 B   | 404992 B   |   8622 KiB |   8423 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 202760 B   | 403468 B   |   8592 KiB |   8394 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 202760 B   | 403468 B   |   8592 KiB |   8394 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1849 KiB |   1984 KiB |  10407 KiB |   8558 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1849 KiB |   1984 KiB |  10407 KiB |   8558 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       8    |     201    |     195    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       8    |     201    |     195    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13786039730011906
Median 	 0.0016637880003145256
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199168 B   | 404992 B   |   8622 KiB |   8428 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199168 B   | 404992 B   |   8622 KiB |   8428 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 199680 B   | 404992 B   |   8622 KiB |   8427 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199680 B   | 404992 B   |   8622 KiB |   8427 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 198661 B   | 403468 B   |   8592 KiB |   8398 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 198661 B   | 403468 B   |   8592 KiB |   8398 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1853 KiB |   1984 KiB |  10411 KiB |   8558 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1853 KiB |   1984 KiB |  10411 KiB |   8558 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       8    |     201    |     196    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       8    |     201    |     196    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 32
[Rank 0]
Time:
Mean 	 0.1386073620999923
Median 	 0.001825661499879061
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201216 B   | 415232 B   |   8894 KiB |   8697 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201216 B   | 415232 B   |   8894 KiB |   8697 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 209920 B   | 415232 B   |   8894 KiB |   8689 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 209920 B   | 415232 B   |   8894 KiB |   8689 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 208904 B   | 413708 B   |   8864 KiB |   8660 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 208904 B   | 413708 B   |   8864 KiB |   8660 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1843 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1843 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       7    |      10    |     189    |     182    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      10    |     189    |     182    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.14128642899977423
Median 	 0.0019903719999092573
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201216 B   | 415232 B   |   8894 KiB |   8698 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201216 B   | 415232 B   |   8894 KiB |   8698 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 210432 B   | 415232 B   |   8894 KiB |   8689 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 210432 B   | 415232 B   |   8894 KiB |   8689 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 208905 B   | 413708 B   |   8864 KiB |   8660 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 208905 B   | 413708 B   |   8864 KiB |   8660 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1842 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1842 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       9    |      18    |     433    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       9    |      18    |     433    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     194    |     189    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     194    |     189    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 64
[Rank 0]
Time:
Mean 	 0.14241735340010564
Median 	 0.0020104490004086983
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 397824 B   |    789 KiB |  17214 KiB |  16825 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397824 B   |    789 KiB |  17214 KiB |  16825 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 406528 B   |    789 KiB |  17214 KiB |  16817 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 406528 B   |    789 KiB |  17214 KiB |  16817 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 405512 B   |    788 KiB |  17184 KiB |  16788 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 405512 B   |    788 KiB |  17184 KiB |  16788 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1651 KiB |   1920 KiB |  18737 KiB |  17086 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1651 KiB |   1920 KiB |  18737 KiB |  17086 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       7    |      10    |     189    |     182    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      10    |     189    |     182    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.141111151899986
Median 	 0.001883910500055208
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 397824 B   |    789 KiB |  17214 KiB |  16826 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397824 B   |    789 KiB |  17214 KiB |  16826 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 398336 B   |    789 KiB |  17214 KiB |  16825 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 398336 B   |    789 KiB |  17214 KiB |  16825 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 397317 B   |    788 KiB |  17184 KiB |  16796 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397317 B   |    788 KiB |  17184 KiB |  16796 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1659 KiB |   1920 KiB |  18745 KiB |  17086 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1659 KiB |   1920 KiB |  18745 KiB |  17086 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |      10    |     189    |     184    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |      10    |     189    |     184    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 32
[Rank 0]
Time:
Mean 	 0.13508176969999114
Median 	 0.0012474925001697557
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 401920 B   |    809 KiB |  17758 KiB |  17365 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401920 B   |    809 KiB |  17758 KiB |  17365 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 418816 B   |    809 KiB |  17758 KiB |  17349 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 418816 B   |    809 KiB |  17758 KiB |  17349 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 417800 B   |    808 KiB |  17728 KiB |  17320 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 417800 B   |    808 KiB |  17728 KiB |  17320 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1639 KiB |   1920 KiB |  19269 KiB |  17630 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1639 KiB |   1920 KiB |  19269 KiB |  17630 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |      10    |     189    |     183    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      10    |     189    |     183    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1351155655000184
Median 	 0.0012430775000211725
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 401920 B   |    809 KiB |  17758 KiB |  17366 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401920 B   |    809 KiB |  17758 KiB |  17366 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 402432 B   |    809 KiB |  17758 KiB |  17365 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 402432 B   |    809 KiB |  17758 KiB |  17365 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 401413 B   |    808 KiB |  17728 KiB |  17336 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401413 B   |    808 KiB |  17728 KiB |  17336 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1655 KiB |   1920 KiB |  19285 KiB |  17630 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1655 KiB |   1920 KiB |  19285 KiB |  17630 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |      10    |     187    |     181    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      10    |     187    |     181    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 64
[Rank 0]
Time:
Mean 	 0.147964154499914
Median 	 0.0019271480000497831
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    776 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    793 KiB |   1577 KiB |  34398 KiB |  33605 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    793 KiB |   1577 KiB |  34398 KiB |  33605 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    792 KiB |   1576 KiB |  34368 KiB |  33576 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    792 KiB |   1576 KiB |  34368 KiB |  33576 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1255 KiB |   1792 KiB |  35397 KiB |  34142 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1255 KiB |   1792 KiB |  35397 KiB |  34142 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       9    |     183    |     177    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       9    |     183    |     177    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1492154558000948
Median 	 0.001928279500134522
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    776 KiB |   1577 KiB |  34398 KiB |  33622 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1577 KiB |  34398 KiB |  33622 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    777 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    777 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    776 KiB |   1576 KiB |  34368 KiB |  33592 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1576 KiB |  34368 KiB |  33592 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1271 KiB |   1792 KiB |  35413 KiB |  34142 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1271 KiB |   1792 KiB |  35413 KiB |  34142 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     183    |     178    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     183    |     178    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```


### Torch Results

```bash
# Report week6

## SyncBatchNorm implementation && Tests for SyncBatchNorm

Пришлось найти формулы градиента, но результат стоил того. Параллельно с имплементацией SyncBatchNorm я сразу запускал и тесты. Это часть, которую еще можно сделать на маке, так что я потратил много времени и мало средств. Дальше остается сделать замеры

## Benchmarking the training pipeline

Чтобы замерить качество, скорость и потребление памяти:
Для торчовского `nn.SyncBatchNorm`:
```python
python torch_ddp_cifar100.py
```
Финальное качество:
```bash
Rank 0, loss: tensor([1.7873], device='cuda:0'), acc: tensor([0.1875], device='cuda:0')
Rank 1, loss: tensor([1.7852], device='cuda:1'), acc: tensor([0.1900], device='cuda:1')
```
Total time: 6612.446699184

Cuda Memory Summary:
```bash
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  30113 KiB |  66090 KiB | 322426 MiB | 322397 MiB |
|       from large pool |  29299 KiB |  65019 KiB | 308267 MiB | 308238 MiB |
|       from small pool |    814 KiB |   3063 KiB |  14159 MiB |  14158 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  30113 KiB |  66090 KiB | 322426 MiB | 322397 MiB |
|       from large pool |  29299 KiB |  65019 KiB | 308267 MiB | 308238 MiB |
|       from small pool |    814 KiB |   3063 KiB |  14159 MiB |  14158 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  30043 KiB |  64481 KiB | 319060 MiB | 319030 MiB |
|       from large pool |  29234 KiB |  63414 KiB | 304952 MiB | 304923 MiB |
|       from small pool |    808 KiB |   3057 KiB |  14108 MiB |  14107 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  96256 KiB |  96256 KiB |  96256 KiB |      0 B   |
|       from large pool |  90112 KiB |  90112 KiB |  90112 KiB |      0 B   |
|       from small pool |   6144 KiB |   6144 KiB |   6144 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  14943 KiB |  37233 KiB | 319449 MiB | 319434 MiB |
|       from large pool |  11661 KiB |  36165 KiB | 305280 MiB | 305269 MiB |
|       from small pool |   3282 KiB |   3762 KiB |  14168 MiB |  14165 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      37    |      47    |  309382    |  309345    |
|       from large pool |       6    |      11    |   58617    |   58611    |
|       from small pool |      31    |      39    |  250765    |  250734    |
|---------------------------------------------------------------------------|
| Active allocs         |      37    |      47    |  309382    |  309345    |
|       from large pool |       6    |      11    |   58617    |   58611    |
|       from small pool |      31    |      39    |  250765    |  250734    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       8    |       8    |       8    |       0    |
|       from large pool |       5    |       5    |       5    |       0    |
|       from small pool |       3    |       3    |       3    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      11    |      16    |  153350    |  153339    |
|       from large pool |       2    |       6    |   27396    |   27394    |
|       from small pool |       9    |      13    |  125954    |  125945    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```

Для кастомного `SyncBatchNorm`:
```python
python ddp_cifar100.py
```

Финальное качество:
```bash
Rank 1, loss: tensor([1.7855], device='cuda:1'), acc: tensor([0.1889], device='cuda:1')
Rank 0, loss: tensor([1.7876], device='cuda:0'), acc: tensor([0.1881], device='cuda:0')
```

Total time: 6801.850327476
```bash
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  27426 KiB |  62088 KiB | 326637 MiB | 326610 MiB |
|       from large pool |  26652 KiB |  61056 KiB | 311402 MiB | 311376 MiB |
|       from small pool |    774 KiB |   3024 KiB |  15234 MiB |  15234 MiB |
|---------------------------------------------------------------------------|
| Active memory         |  27426 KiB |  62090 KiB | 326637 MiB | 326610 MiB |
|       from large pool |  26652 KiB |  61056 KiB | 311402 MiB | 311376 MiB |
|       from small pool |    774 KiB |   3024 KiB |  15234 MiB |  15234 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |  26817 KiB |  61256 KiB | 320153 MiB | 320127 MiB |
|       from large pool |  26048 KiB |  60228 KiB | 304942 MiB | 304917 MiB |
|       from small pool |    769 KiB |   3018 KiB |  15211 MiB |  15210 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  96256 KiB |  96256 KiB |  96256 KiB |      0 B   |
|       from large pool |  90112 KiB |  90112 KiB |  90112 KiB |      0 B   |
|       from small pool |   6144 KiB |   6144 KiB |   6144 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  38109 KiB |  52691 KiB | 271693 MiB | 271656 MiB |
|       from large pool |  34788 KiB |  49664 KiB | 256447 MiB | 256413 MiB |
|       from small pool |   3321 KiB |   3801 KiB |  15246 MiB |  15243 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      36    |      48    |  336742    |  336706    |
|       from large pool |       5    |      10    |   58614    |   58609    |
|       from small pool |      31    |      41    |  278128    |  278097    |
|---------------------------------------------------------------------------|
| Active allocs         |      36    |      48    |  336742    |  336706    |
|       from large pool |       5    |      10    |   58614    |   58609    |
|       from small pool |      31    |      41    |  278128    |  278097    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       8    |       8    |       8    |       0    |
|       from large pool |       5    |       5    |       5    |       0    |
|       from small pool |       3    |       3    |       3    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      15    |      17    |  180060    |  180045    |
|       from large pool |       4    |       7    |   27343    |   27339    |
|       from small pool |      11    |      14    |  152717    |  152706    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```


## Performance benchmarks

Чтобы запустить замеры нужно запустить:

```python
python benchmark_torch_syncbn.py
```

Предварительно в коде нужно выбрать своего бойца - кастомный или оригинальный SyncBatchNorm

Результаты для кастомного:

### Custom Results

```bash
---------------------
Hidden dim: 128, Batch size: 32
[Rank 0]
Time:
Mean 	 0.1390621140998519
Median 	 0.00154946149996249
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  50688 B   | 104960 B   |   2246 KiB |   2196 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50688 B   | 104960 B   |   2246 KiB |   2196 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  53248 B   | 104960 B   |   2246 KiB |   2194 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  53248 B   | 104960 B   |   2246 KiB |   2194 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  52232 B   | 103436 B   |   2216 KiB |   2165 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  52232 B   | 103436 B   |   2216 KiB |   2165 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1996 KiB |   2032 KiB |   4226 KiB |   2230 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1996 KiB |   2032 KiB |   4226 KiB |   2230 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13840712750006787
Median 	 0.0015549710001323547
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  50688 B   | 104960 B   |   2246 KiB |   2197 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50688 B   | 104960 B   |   2246 KiB |   2197 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  51200 B   | 104960 B   |   2246 KiB |   2196 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  51200 B   | 104960 B   |   2246 KiB |   2196 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  50181 B   | 103436 B   |   2216 KiB |   2167 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  50181 B   | 103436 B   |   2216 KiB |   2167 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1998 KiB |   2032 KiB |   4228 KiB |   2230 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1998 KiB |   2032 KiB |   4228 KiB |   2230 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 128, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1390653965999263
Median 	 0.0012058480001542193
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  99840 B   | 203264 B   |   4326 KiB |   4228 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99840 B   | 203264 B   |   4326 KiB |   4228 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 102400 B   | 203264 B   |   4326 KiB |   4226 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 102400 B   | 203264 B   |   4326 KiB |   4226 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 101384 B   | 201740 B   |   4296 KiB |   4197 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101384 B   | 201740 B   |   4296 KiB |   4197 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1948 KiB |   2016 KiB |   6242 KiB |   4294 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1948 KiB |   2016 KiB |   6242 KiB |   4294 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1377064262001113
Median 	 0.0012254574999133183
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  99840 B   | 203264 B   |   4326 KiB |   4229 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99840 B   | 203264 B   |   4326 KiB |   4229 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 100352 B   | 203264 B   |   4326 KiB |   4228 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100352 B   | 203264 B   |   4326 KiB |   4228 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  99333 B   | 201740 B   |   4296 KiB |   4199 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99333 B   | 201740 B   |   4296 KiB |   4199 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1950 KiB |   2016 KiB |   6244 KiB |   4294 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1950 KiB |   2016 KiB |   6244 KiB |   4294 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     218    |     213    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     218    |     213    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 32
[Rank 0]
Time:
Mean 	 0.13332746870000847
Median 	 0.0012237730002198077
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100864 B   | 208384 B   |   4462 KiB |   4363 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100864 B   | 208384 B   |   4462 KiB |   4363 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 105472 B   | 208384 B   |   4462 KiB |   4359 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 105472 B   | 208384 B   |   4462 KiB |   4359 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 104456 B   | 206860 B   |   4432 KiB |   4330 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 104456 B   | 206860 B   |   4432 KiB |   4330 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1945 KiB |   2016 KiB |   6375 KiB |   4430 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1945 KiB |   2016 KiB |   6375 KiB |   4430 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       8    |     201    |     195    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       8    |     201    |     195    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1331688328998098
Median 	 0.0012086579999959213
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100864 B   | 208384 B   |   4462 KiB |   4364 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100864 B   | 208384 B   |   4462 KiB |   4364 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 101376 B   | 208384 B   |   4462 KiB |   4363 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101376 B   | 208384 B   |   4462 KiB |   4363 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 100357 B   | 206860 B   |   4432 KiB |   4334 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100357 B   | 206860 B   |   4432 KiB |   4334 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1949 KiB |   2016 KiB |   6379 KiB |   4430 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1949 KiB |   2016 KiB |   6379 KiB |   4430 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       8    |     201    |     196    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       8    |     201    |     196    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1378585768998164
Median 	 0.0017587544998605154
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199168 B   | 404992 B   |   8622 KiB |   8427 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199168 B   | 404992 B   |   8622 KiB |   8427 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 203776 B   | 404992 B   |   8622 KiB |   8423 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 203776 B   | 404992 B   |   8622 KiB |   8423 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 202760 B   | 403468 B   |   8592 KiB |   8394 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 202760 B   | 403468 B   |   8592 KiB |   8394 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1849 KiB |   1984 KiB |  10407 KiB |   8558 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1849 KiB |   1984 KiB |  10407 KiB |   8558 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       8    |     201    |     195    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       8    |     201    |     195    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13786039730011906
Median 	 0.0016637880003145256
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199168 B   | 404992 B   |   8622 KiB |   8428 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199168 B   | 404992 B   |   8622 KiB |   8428 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 199680 B   | 404992 B   |   8622 KiB |   8427 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199680 B   | 404992 B   |   8622 KiB |   8427 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 198661 B   | 403468 B   |   8592 KiB |   8398 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 198661 B   | 403468 B   |   8592 KiB |   8398 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1853 KiB |   1984 KiB |  10411 KiB |   8558 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1853 KiB |   1984 KiB |  10411 KiB |   8558 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       8    |     201    |     196    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       8    |     201    |     196    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 32
[Rank 0]
Time:
Mean 	 0.1386073620999923
Median 	 0.001825661499879061
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201216 B   | 415232 B   |   8894 KiB |   8697 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201216 B   | 415232 B   |   8894 KiB |   8697 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 209920 B   | 415232 B   |   8894 KiB |   8689 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 209920 B   | 415232 B   |   8894 KiB |   8689 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 208904 B   | 413708 B   |   8864 KiB |   8660 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 208904 B   | 413708 B   |   8864 KiB |   8660 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1843 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1843 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       7    |      10    |     189    |     182    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      10    |     189    |     182    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.14128642899977423
Median 	 0.0019903719999092573
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201216 B   | 415232 B   |   8894 KiB |   8698 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201216 B   | 415232 B   |   8894 KiB |   8698 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 210432 B   | 415232 B   |   8894 KiB |   8689 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 210432 B   | 415232 B   |   8894 KiB |   8689 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 208905 B   | 413708 B   |   8864 KiB |   8660 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 208905 B   | 413708 B   |   8864 KiB |   8660 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1842 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1842 KiB |   1984 KiB |  10673 KiB |   8830 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       9    |      18    |     433    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       9    |      18    |     433    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     194    |     189    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     194    |     189    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 64
[Rank 0]
Time:
Mean 	 0.14241735340010564
Median 	 0.0020104490004086983
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 397824 B   |    789 KiB |  17214 KiB |  16825 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397824 B   |    789 KiB |  17214 KiB |  16825 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 406528 B   |    789 KiB |  17214 KiB |  16817 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 406528 B   |    789 KiB |  17214 KiB |  16817 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 405512 B   |    788 KiB |  17184 KiB |  16788 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 405512 B   |    788 KiB |  17184 KiB |  16788 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1651 KiB |   1920 KiB |  18737 KiB |  17086 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1651 KiB |   1920 KiB |  18737 KiB |  17086 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       7    |      10    |     189    |     182    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      10    |     189    |     182    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.141111151899986
Median 	 0.001883910500055208
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 397824 B   |    789 KiB |  17214 KiB |  16826 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397824 B   |    789 KiB |  17214 KiB |  16826 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 398336 B   |    789 KiB |  17214 KiB |  16825 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 398336 B   |    789 KiB |  17214 KiB |  16825 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 397317 B   |    788 KiB |  17184 KiB |  16796 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 397317 B   |    788 KiB |  17184 KiB |  16796 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1659 KiB |   1920 KiB |  18745 KiB |  17086 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1659 KiB |   1920 KiB |  18745 KiB |  17086 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |      10    |     189    |     184    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |      10    |     189    |     184    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 32
[Rank 0]
Time:
Mean 	 0.13508176969999114
Median 	 0.0012474925001697557
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 401920 B   |    809 KiB |  17758 KiB |  17365 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401920 B   |    809 KiB |  17758 KiB |  17365 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 418816 B   |    809 KiB |  17758 KiB |  17349 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 418816 B   |    809 KiB |  17758 KiB |  17349 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 417800 B   |    808 KiB |  17728 KiB |  17320 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 417800 B   |    808 KiB |  17728 KiB |  17320 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1639 KiB |   1920 KiB |  19269 KiB |  17630 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1639 KiB |   1920 KiB |  19269 KiB |  17630 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |      10    |     189    |     183    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      10    |     189    |     183    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1351155655000184
Median 	 0.0012430775000211725
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 401920 B   |    809 KiB |  17758 KiB |  17366 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401920 B   |    809 KiB |  17758 KiB |  17366 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 402432 B   |    809 KiB |  17758 KiB |  17365 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 402432 B   |    809 KiB |  17758 KiB |  17365 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 401413 B   |    808 KiB |  17728 KiB |  17336 KiB |
|       from large pool |      0 B   |      0 KiB |      0 KiB |      0 KiB |
|       from small pool | 401413 B   |    808 KiB |  17728 KiB |  17336 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1655 KiB |   1920 KiB |  19285 KiB |  17630 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1655 KiB |   1920 KiB |  19285 KiB |  17630 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |      10    |     187    |     181    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      10    |     187    |     181    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 64
[Rank 0]
Time:
Mean 	 0.147964154499914
Median 	 0.0019271480000497831
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    776 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    793 KiB |   1577 KiB |  34398 KiB |  33605 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    793 KiB |   1577 KiB |  34398 KiB |  33605 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    792 KiB |   1576 KiB |  34368 KiB |  33576 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    792 KiB |   1576 KiB |  34368 KiB |  33576 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1255 KiB |   1792 KiB |  35397 KiB |  34142 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1255 KiB |   1792 KiB |  35397 KiB |  34142 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     432    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     432    |     426    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      18    |     432    |     424    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      18    |     432    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       6    |       9    |     183    |     177    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |       9    |     183    |     177    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1492154558000948
Median 	 0.001928279500134522
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    776 KiB |   1577 KiB |  34398 KiB |  33622 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1577 KiB |  34398 KiB |  33622 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    777 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    777 KiB |   1577 KiB |  34398 KiB |  33621 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    776 KiB |   1576 KiB |  34368 KiB |  33592 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1576 KiB |  34368 KiB |  33592 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1271 KiB |   1792 KiB |  35413 KiB |  34142 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1271 KiB |   1792 KiB |  35413 KiB |  34142 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       6    |      18    |     433    |     427    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       6    |      18    |     433    |     427    |
|---------------------------------------------------------------------------|
| Active allocs         |       7    |      18    |     433    |     426    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      18    |     433    |     426    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       9    |     183    |     178    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       9    |     183    |     178    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```


### Torch Results

```bash
---------------------
Hidden dim: 128, Batch size: 32
[Rank 0]
Time:
Mean 	 0.14226165380014208
Median 	 0.0012984375002815796
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  51200 B   |  91648 B   |    856 KiB |    806 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  51200 B   |  91648 B   |    856 KiB |    806 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  52224 B   |  91648 B   |    856 KiB |    805 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  52224 B   |  91648 B   |    856 KiB |    805 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  51212 B   |  88106 B   | 772692 B   | 721480 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |  51212 B   |  88106 B   | 772692 B   | 721480 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1997 KiB |   2047 KiB |   2853 KiB |    856 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1997 KiB |   2047 KiB |   2853 KiB |    856 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       7    |     139    |     135    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       7    |     139    |     135    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.14084144240005117
Median 	 0.00128884849982569
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  51200 B   |  91648 B   |    857 KiB |    807 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  51200 B   |  91648 B   |    857 KiB |    807 KiB |
|---------------------------------------------------------------------------|
| Active memory         |  51712 B   |  91648 B   |    857 KiB |    806 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  51712 B   |  91648 B   |    857 KiB |    806 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  50189 B   |  88106 B   | 772693 B   | 722504 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |  50189 B   |  88106 B   | 772693 B   | 722504 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1997 KiB |   2047 KiB |   2854 KiB |    856 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1997 KiB |   2047 KiB |   2854 KiB |    856 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       8    |     167    |     164    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       8    |     167    |     164    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 128, Batch size: 64
[Rank 0]
Time:
Mean 	 0.13351138080006422
Median 	 0.0012360660002741497
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100352 B   | 173568 B   |   1496 KiB |   1398 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100352 B   | 173568 B   |   1496 KiB |   1398 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 101376 B   | 173568 B   |   1496 KiB |   1397 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101376 B   | 173568 B   |   1496 KiB |   1397 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 100364 B   | 170026 B   |   1394 KiB |   1296 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100364 B   | 170026 B   |   1394 KiB |   1296 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1949 KiB |   2047 KiB |   3445 KiB |   1496 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1949 KiB |   2047 KiB |   3445 KiB |   1496 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       7    |     139    |     135    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       7    |     139    |     135    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13267978650019358
Median 	 0.001203299500502908
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 100352 B   | 173568 B   |   1497 KiB |   1399 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100352 B   | 173568 B   |   1497 KiB |   1399 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 100864 B   | 173568 B   |   1497 KiB |   1398 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100864 B   | 173568 B   |   1497 KiB |   1398 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |  99341 B   | 170026 B   |   1394 KiB |   1297 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool |  99341 B   | 170026 B   |   1394 KiB |   1297 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1949 KiB |   2047 KiB |   3446 KiB |   1496 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1949 KiB |   2047 KiB |   3446 KiB |   1496 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       8    |     167    |     164    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       8    |     167    |     164    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 32
[Rank 0]
Time:
Mean 	 0.1356455015001302
Median 	 0.0013892484998905275
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 101376 B   | 179712 B   |   1587 KiB |   1488 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101376 B   | 179712 B   |   1587 KiB |   1488 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 103424 B   | 179712 B   |   1587 KiB |   1486 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 103424 B   | 179712 B   |   1587 KiB |   1486 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 102412 B   | 176170 B   |   1485 KiB |   1385 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 102412 B   | 176170 B   |   1485 KiB |   1385 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1947 KiB |   2047 KiB |   3533 KiB |   1586 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1947 KiB |   2047 KiB |   3533 KiB |   1586 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       6    |     122    |     118    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       6    |     122    |     118    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1356741644000067
Median 	 0.0013338795001800463
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 101376 B   | 179712 B   |   1588 KiB |   1489 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101376 B   | 179712 B   |   1588 KiB |   1489 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 101888 B   | 179712 B   |   1588 KiB |   1488 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 101888 B   | 179712 B   |   1588 KiB |   1488 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 100365 B   | 176170 B   |   1485 KiB |   1387 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 100365 B   | 176170 B   |   1485 KiB |   1387 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1948 KiB |   2047 KiB |   3535 KiB |   1587 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1948 KiB |   2047 KiB |   3535 KiB |   1587 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       7    |     126    |     122    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       7    |     126    |     122    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 256, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1307657735000248
Median 	 0.0013590375001513166
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199680 B   | 343552 B   |   2867 KiB |   2672 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199680 B   | 343552 B   |   2867 KiB |   2672 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 201728 B   | 343552 B   |   2867 KiB |   2670 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201728 B   | 343552 B   |   2867 KiB |   2670 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 200716 B   | 340010 B   |   2765 KiB |   2569 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 200716 B   | 340010 B   |   2765 KiB |   2569 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1851 KiB |   2047 KiB |   4717 KiB |   2866 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1851 KiB |   2047 KiB |   4717 KiB |   2866 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       7    |     135    |     130    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       7    |     135    |     130    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.13260653240004103
Median 	 0.0013087544998597878
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 199680 B   | 343552 B   |   2868 KiB |   2673 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 199680 B   | 343552 B   |   2868 KiB |   2673 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 200192 B   | 343552 B   |   2868 KiB |   2672 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 200192 B   | 343552 B   |   2868 KiB |   2672 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 198669 B   | 340010 B   |   2765 KiB |   2571 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 198669 B   | 340010 B   |   2765 KiB |   2571 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1852 KiB |   2047 KiB |   4719 KiB |   2867 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1852 KiB |   2047 KiB |   4719 KiB |   2867 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       7    |     117    |     114    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       7    |     117    |     114    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 32
[Rank 0]
Time:
Mean 	 0.138284686300085
Median 	 0.00183953349960575
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201728 B   | 355840 B   |   3049 KiB |   2852 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201728 B   | 355840 B   |   3049 KiB |   2852 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 205824 B   | 355840 B   |   3049 KiB |   2848 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 205824 B   | 355840 B   |   3049 KiB |   2848 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 204812 B   | 352298 B   |   2947 KiB |   2747 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 204812 B   | 352298 B   |   2947 KiB |   2747 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1847 KiB |   2046 KiB |   4894 KiB |   3047 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1847 KiB |   2046 KiB |   4894 KiB |   3047 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       8    |     128    |     123    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       8    |     128    |     123    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1368464925999433
Median 	 0.0017569325000295066
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 201728 B   | 355840 B   |   3050 KiB |   2853 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 201728 B   | 355840 B   |   3050 KiB |   2853 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 202240 B   | 355840 B   |   3050 KiB |   2852 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 202240 B   | 355840 B   |   3050 KiB |   2852 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 200717 B   | 352298 B   |   2947 KiB |   2751 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 200717 B   | 352298 B   |   2947 KiB |   2751 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1850 KiB |   2046 KiB |   4898 KiB |   3048 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1850 KiB |   2046 KiB |   4898 KiB |   3048 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       7    |     129    |     125    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       7    |     129    |     125    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 512, Batch size: 64
[Rank 0]
Time:
Mean 	 0.13615148090011644
Median 	 0.0016713835002519772
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 398336 B   | 683520 B   |   5609 KiB |   5220 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 398336 B   | 683520 B   |   5609 KiB |   5220 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 402432 B   | 683520 B   |   5609 KiB |   5216 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 402432 B   | 683520 B   |   5609 KiB |   5216 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 401420 B   | 679978 B   |   5507 KiB |   5115 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 401420 B   | 679978 B   |   5507 KiB |   5115 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1655 KiB |   2046 KiB |   7262 KiB |   5607 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1655 KiB |   2046 KiB |   7262 KiB |   5607 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       7    |     114    |     109    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       7    |     114    |     109    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1365806653000618
Median 	 0.001726384500216227
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 398336 B   | 683520 B   |   5610 KiB |   5221 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 398336 B   | 683520 B   |   5610 KiB |   5221 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 398848 B   | 683520 B   |   5610 KiB |   5220 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 398848 B   | 683520 B   |   5610 KiB |   5220 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 397325 B   | 679978 B   |   5507 KiB |   5119 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 397325 B   | 679978 B   |   5507 KiB |   5119 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1658 KiB |   2046 KiB |   7266 KiB |   5608 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1658 KiB |   2046 KiB |   7266 KiB |   5608 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       7    |     120    |     117    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       7    |     120    |     117    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 32
[Rank 0]
Time:
Mean 	 0.14018739340008324
Median 	 0.0013744470002166054
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 402432 B   | 708096 B   |   5973 KiB |   5580 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 402432 B   | 708096 B   |   5973 KiB |   5580 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 410624 B   | 708096 B   |   5973 KiB |   5572 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 410624 B   | 708096 B   |   5973 KiB |   5572 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 409612 B   | 704554 B   |   5871 KiB |   5471 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 409612 B   | 704554 B   |   5871 KiB |   5471 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1647 KiB |   2044 KiB |   7616 KiB |   5969 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1647 KiB |   2044 KiB |   7616 KiB |   5969 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       5    |       7    |     120    |     115    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       5    |       7    |     120    |     115    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.1417311801998949
Median 	 0.001344503499694838
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 402432 B   | 708096 B   |   5974 KiB |   5581 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 402432 B   | 708096 B   |   5974 KiB |   5581 KiB |
|---------------------------------------------------------------------------|
| Active memory         | 402944 B   | 708096 B   |   5974 KiB |   5580 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 402944 B   | 708096 B   |   5974 KiB |   5580 KiB |
|---------------------------------------------------------------------------|
| Requested memory      | 401421 B   | 704554 B   |   5871 KiB |   5479 KiB |
|       from large pool |      0 B   |      0 B   |      0 KiB |      0 KiB |
|       from small pool | 401421 B   | 704554 B   |   5871 KiB |   5479 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1654 KiB |   2044 KiB |   7624 KiB |   5970 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1654 KiB |   2044 KiB |   7624 KiB |   5970 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       8    |     114    |     111    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       8    |     114    |     111    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

---------------------
Hidden dim: 1024, Batch size: 64
[Rank 0]
Time:
Mean 	 0.1427383072998964
Median 	 0.0016029159996833187
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    777 KiB |   1331 KiB |  11093 KiB |  10316 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    777 KiB |   1331 KiB |  11093 KiB |  10316 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    785 KiB |   1331 KiB |  11093 KiB |  10308 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    785 KiB |   1331 KiB |  11093 KiB |  10308 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    784 KiB |   1328 KiB |  10991 KiB |  10207 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    784 KiB |   1328 KiB |  10991 KiB |  10207 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1263 KiB |   2044 KiB |  12352 KiB |  11089 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1263 KiB |   2044 KiB |  12352 KiB |  11089 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     353    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     353    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     353    |     345    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     353    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |       7    |     107    |     103    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       4    |       7    |     107    |     103    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Rank 1]
Time:
Mean 	 0.14277996339978927
Median 	 0.0018334315000174684
Cuda memory summary:
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    777 KiB |   1331 KiB |  11094 KiB |  10317 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    777 KiB |   1331 KiB |  11094 KiB |  10317 KiB |
|---------------------------------------------------------------------------|
| Active memory         |    777 KiB |   1331 KiB |  11094 KiB |  10316 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    777 KiB |   1331 KiB |  11094 KiB |  10316 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |    776 KiB |   1328 KiB |  10991 KiB |  10215 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |    776 KiB |   1328 KiB |  10991 KiB |  10215 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 B   |
|       from small pool |   2048 KiB |   2048 KiB |   2048 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1270 KiB |   2044 KiB |  12360 KiB |  11090 KiB |
|       from large pool |      0 KiB |      0 KiB |      0 KiB |      0 KiB |
|       from small pool |   1270 KiB |   2044 KiB |  12360 KiB |  11090 KiB |
|---------------------------------------------------------------------------|
| Allocations           |       7    |      19    |     354    |     347    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       7    |      19    |     354    |     347    |
|---------------------------------------------------------------------------|
| Active allocs         |       8    |      19    |     354    |     346    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       8    |      19    |     354    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       1    |       1    |       1    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       1    |       1    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |       8    |     127    |     124    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       3    |       8    |     127    |     124    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|
```